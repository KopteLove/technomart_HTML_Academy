"use strict";var link=$(".button-write-us"),popupForm=$(".modal-write-us"),closeForm=$(".close-form"),mapImg=$(".map-img"),map=$(".map-popup"),closeMap=$(".close-map"),cart=$(".modal-cart"),buy=$(".button-buy"),basket=$(".basket"),closeCart=$(".close-cart"),continueBuy=$(".modal-cart-button-continue"),order=$(".modal-cart-button-buy"),basketQuantity=$(".js-basket-quantity"),btnBookmark=$(".button-bookmark"),bookmark=$(".bookmark"),list=$(".product-list"),upPrice=$(".sorting-price-up"),downPrice=$(".sorting-price-down"),abcSort=$(".sorting-abc"),abcSortRevers=$(".sorting-abc-revers"),allSortBtn=$(".sorting-button"),range=$(".js-price-range"),INITIAL_RANGE_VALUES=[500,5e3],MIN_RANGE=0,MAX_RANGE=5500,itemsArr=[],bookmarkQuantity=$(".js-bookmark-quantity"),bookmarkCount=0,basketCount=0,form=$(".modal-write-us-form"),login=$("#user-name"),email=$("#user-email"),comment=$("#comment"),storageLogin="",storageEmail="",isSupportStorageLogin=!0;try{storageLogin=localStorage.getItem("login")}catch(e){isSupportStorageLogin=!1}var isSupportStorageEmail=!0;try{storageEmail=localStorage.getItem("email")}catch(e){isSupportStorageEmail=!1}function validateEmail(e){return/^[\w]{1}[\w-\.]*@[\w-]+\.[a-z]{2,4}$/i.test(e)}function getArr(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=list.children();itemsArr=[],e&&e.addClass("active");for(var r=0;r<t.length;++r)itemsArr.push(t[r])}function sortPrice(){itemsArr.sort(function(e,t){if(parseFloat(e.getAttribute("data-price"))===parseFloat(t.getAttribute("data-price")))return 0;if(parseFloat(e.getAttribute("data-price"))>parseFloat(t.getAttribute("data-price"))){if(upPrice.hasClass("active"))return 1;if(downPrice.hasClass("active"))return-1}else if(parseFloat(e.getAttribute("data-price"))<parseFloat(t.getAttribute("data-price"))){if(upPrice.hasClass("active"))return-1;if(downPrice.hasClass("active"))return 1}})}function sortAbc(){itemsArr.sort(function(e,t){if(e.children[1].children[0].children[0].textContent===t.children[1].children[0].children[0].textContent)return 0;if(e.children[1].children[0].children[0].textContent>t.children[1].children[0].children[0].textContent){if(abcSort.hasClass("active"))return 1;if(abcSortRevers.hasClass("active"))return-1}else if(e.children[1].children[0].children[0].textContent<t.children[1].children[0].children[0].textContent){if(abcSort.hasClass("active"))return-1;if(abcSortRevers.hasClass("active"))return 1}})}function embedsNewList(e){for(var t=0;t<e.length;++t)list.append(e[t])}function sortsProductsByRange(){getArr();for(var e=0;e<itemsArr.length;++e)$(itemsArr[e]).attr("data-price")>=range.slider("values",0)&&$(itemsArr[e]).attr("data-price")<=range.slider("values",1)?$(itemsArr[e]).removeClass("hide"):$(itemsArr[e]).addClass("hide")}function sortProductByPower(){getArr();var e=$('[name="power"]:checked').val();if("all"===e)$(".product-item").removeClass("hide-power");else for(var t=0;t<itemsArr.length;++t)$(itemsArr[t]).attr("data-power")===e?$(itemsArr[t]).removeClass("hide-power"):$(itemsArr[t]).addClass("hide-power")}function sortProductByFirm(){var r=$(".filters-checkbox-item input:checked").get().map(function(e){return $(e).attr("name")});0===r.length?$(".product-item").removeClass("hide-firm"):$(".product-item").each(function(e,t){r.includes($(t).attr("data-firm"))?$(t).removeClass("hide-firm"):$(t).addClass("hide-firm")})}function getRangeValues(e){return range.slider("values",e)}function setValueToInputs(){$(".js-price-min").attr("value",getRangeValues(0)),$(".js-price-max").attr("value",getRangeValues(1))}function setHandleValues(e){$(".ui-slider-handle:nth-child(2) .ui-slider-handle-value").text(e[0]+"₽"),$(".ui-slider-handle:nth-child(3) .ui-slider-handle-value").text(e[1]+"₽")}$(function(){link.on("click",function(e){e.preventDefault(),popupForm.addClass("js-modal-show"),setTimeout(function(){return popupForm.addClass("open")},800),storageLogin?(login.val(storageLogin),email.focus(),email.val(storageEmail),comment.focus()):login.focus()}),closeForm.on("click",function(e){e.preventDefault(),popupForm.removeClass("js-modal-show js-modal-error open")}),form.on("submit",function(e){login.val().length<3||!validateEmail(email.val())||!comment.val()?(e.preventDefault(),popupForm.addClass("js-modal-error"),setTimeout(function(){return popupForm.removeClass("js-modal-error")},800),login.val().length<3?login.focus():validateEmail(email.val())?comment.focus():email.focus()):(isSupportStorageLogin&&localStorage.setItem("login",login.val()),isSupportStorageEmail&&localStorage.setItem("email",email.val()))}),mapImg.on("click",function(e){e.preventDefault(),map.addClass("js-modal-show")}),closeMap.on("click",function(e){e.preventDefault(),map.removeClass("js-modal-show")}),basketQuantity.text(basketCount+""),buy.click(function(e){e.preventDefault(),cart.addClass("js-modal-show"),basket.addClass("color-red"),basketCount++,basketQuantity.text(basketCount+"")}),closeCart.on("click",function(e){e.preventDefault(),cart.removeClass("js-modal-show")}),order.on("click",function(e){e.preventDefault(),cart.removeClass("js-modal-show")}),continueBuy.on("click",function(e){e.preventDefault(),cart.removeClass("js-modal-show")}),bookmarkQuantity.text(bookmarkCount+""),btnBookmark.click(function(e){e.preventDefault(),bookmark.addClass("color-red"),bookmarkCount++,bookmarkQuantity.text(bookmarkCount+"")}),upPrice.on("click",function(){allSortBtn.removeClass("active"),getArr(upPrice),sortPrice(),embedsNewList(itemsArr)}),downPrice.on("click",function(){allSortBtn.removeClass("active"),getArr(downPrice),sortPrice(),embedsNewList(itemsArr)}),abcSort.on("click",function(){allSortBtn.removeClass("active"),getArr(abcSort),sortAbc(),embedsNewList(itemsArr)}),abcSortRevers.on("click",function(){allSortBtn.removeClass("active"),getArr(abcSortRevers),sortAbc(),embedsNewList(itemsArr)}),$(".filters-radio-item").on("change",function(){sortProductByPower()}),$(".filters-checkbox-item").on("change",function(){sortProductByFirm()}),range.slider({range:!0,min:MIN_RANGE,max:MAX_RANGE,values:INITIAL_RANGE_VALUES,slide:function(e,t){$(".js-price-min").val(t.values[0]),$(".js-price-max").val(t.values[1]),setHandleValues(t.values),sortsProductsByRange()}}),setValueToInputs(),$(".js-price-min").change(function(){var e=$(".js-price-min").val(),t=$(".js-price-max").val();Number(e)<=Number(t)?(Number(e)<MIN_RANGE&&(e=MIN_RANGE,$(".js-price-min").val(e)),range.slider("values",0,e),$(".ui-slider-handle:nth-child(2) .ui-slider-handle-value").text(e+"₽")):(range.slider("values",0,t),$(".ui-slider-handle:nth-child(2) .ui-slider-handle-value").text(t+"₽"),$(".js-price-min").val(t)),sortsProductsByRange()}),$(".js-price-max").change(function(){var e=$(".js-price-min").val(),t=$(".js-price-max").val();Number(t)>=Number(e)?(Number(t)>MAX_RANGE&&(t=MAX_RANGE,$(".js-price-max").val(t)),range.slider("values",1,t),$(".ui-slider-handle:nth-child(3) .ui-slider-handle-value").text(t+"₽")):(range.slider("values",1,e),$(".ui-slider-handle:nth-child(3) .ui-slider-handle-value").text(e+"₽"),$(".js-price-max").val(e)),sortsProductsByRange()}),setTimeout(function(){var e=$('<span class="ui-slider-handle-value"></span>').text(range.slider("values",0)+"₽");$(".js-price-range .ui-slider-handle:nth-child(2)").append(e)}),setTimeout(function(){var e=$('<span class="ui-slider-handle-value"></span>').text(range.slider("values",1)+"₽");$(".js-price-range .ui-slider-handle:nth-child(3)").append(e)}),$(".js-clear-all").on("click",function(){range.slider("values",INITIAL_RANGE_VALUES),setValueToInputs(),setHandleValues(INITIAL_RANGE_VALUES)}),$(window).on("keydown",function(e){27===e.keyCode&&(popupForm.hasClass("js-modal-show")&&(e.preventDefault(),popupForm.removeClass("js-modal-show"),popupForm.removeClass("js-modal-error")),map.hasClass("js-modal-show")&&(e.preventDefault(),map.removeClass("js-modal-show")),cart.hasClass("js-modal-show")&&(e.preventDefault(),cart.removeClass("js-modal-show")))})});